{
  "version": 3,
  "sources": ["../../../../../lambda/users/create-profile/index.ts"],
  "sourcesContent": ["// =============================================================================\n// lambda/users/create-profile/index.ts\n// =============================================================================\n\nimport { APIGatewayProxyEvent, APIGatewayProxyResult } from 'aws-lambda';\nimport { DynamoDBClient } from '@aws-sdk/client-dynamodb';\nimport { DynamoDBDocumentClient, PutCommand, GetCommand } from '@aws-sdk/lib-dynamodb';\n\nconst dynamoClient = new DynamoDBClient({\n  region: process.env.AWS_REGION || 'us-east-1',\n  ...(process.env.STAGE === 'local' && {\n    endpoint: 'http://localhost:8000',\n    credentials: { accessKeyId: 'local', secretAccessKey: 'local' },\n  }),\n});\n\nconst docClient = DynamoDBDocumentClient.from(dynamoClient);\n\nexport const handler = async (\n  event: APIGatewayProxyEvent\n): Promise<APIGatewayProxyResult> => {\n  try {\n    if (!event.body) {\n      return {\n        statusCode: 400,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n        body: JSON.stringify({ error: 'Request body is required' }),\n      };\n    }\n\n    const body = JSON.parse(event.body);\n    const now = new Date().toISOString();\n\n    // TODO: Get userId from Cognito JWT token\n    const userId = body.userId || `user${Date.now()}`;\n\n    // Check if profile already exists\n    const existing = await docClient.send(\n      new GetCommand({\n        TableName: process.env.TABLE_NAME || 'ELearningPlatform-local',\n        Key: { PK: `USER#${userId}`, SK: 'PROFILE' },\n      })\n    );\n\n    if (existing.Item) {\n      return {\n        statusCode: 409,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n        body: JSON.stringify({ error: 'Profile already exists' }),\n      };\n    }\n\n    // Create user profile\n    const profileData = {\n      PK: `USER#${userId}`,\n      SK: 'PROFILE',\n      EntityType: 'UserProfile',\n      userId,\n      email: body.email,\n      name: body.name,\n      avatar: body.avatar || null,\n      role: body.role || 'STUDENT',\n      bio: body.bio || '',\n      website: body.website || '',\n      socialLinks: body.socialLinks || {},\n      createdAt: now,\n      updatedAt: now,\n      isActive: true,\n      isEmailVerified: body.isEmailVerified || false,\n      \n      GSI1PK: `EMAIL#${body.email}`,\n      GSI1SK: `USER#${userId}`,\n      GSI2PK: `ROLE#${body.role || 'STUDENT'}`,\n      GSI2SK: `USER#${userId}`,\n    };\n\n    await docClient.send(\n      new PutCommand({\n        TableName: process.env.TABLE_NAME || 'ELearningPlatform-local',\n        Item: profileData,\n      })\n    );\n\n    // Create default settings\n    const settingsData = {\n      PK: `USER#${userId}`,\n      SK: 'SETTINGS',\n      EntityType: 'UserSettings',\n      notifications: {\n        email: true,\n        push: true,\n        courseUpdates: true,\n        newCourses: false,\n      },\n      privacy: {\n        showProfile: true,\n        showProgress: false,\n      },\n      preferences: {\n        language: 'en',\n        theme: 'light',\n        videoQuality: 'auto',\n        playbackSpeed: 1.0,\n      },\n      updatedAt: now,\n    };\n\n    await docClient.send(\n      new PutCommand({\n        TableName: process.env.TABLE_NAME || 'ELearningPlatform-local',\n        Item: settingsData,\n      })\n    );\n\n    return {\n      statusCode: 201,\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n      },\n      body: JSON.stringify({\n        message: 'User profile created successfully',\n        profile: profileData,\n        settings: settingsData,\n      }),\n    };\n  } catch (error) {\n    console.error('Error:', error);\n    return {\n      statusCode: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n      body: JSON.stringify({\n        error: 'Internal server error',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      }),\n    };\n  }\n};\n"],
  "mappings": "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",
  "names": []
}
