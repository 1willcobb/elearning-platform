{
  "version": 3,
  "sources": ["../../../../../lambda/lessons/reorder/index.ts"],
  "sourcesContent": ["import { APIGatewayProxyEvent, APIGatewayProxyResult } from 'aws-lambda';\nimport { DynamoDBClient } from '@aws-sdk/client-dynamodb';\nimport { DynamoDBDocumentClient, UpdateCommand, QueryCommand } from '@aws-sdk/lib-dynamodb';\n\nconst dynamoClient = new DynamoDBClient({\n  region: process.env.AWS_REGION || 'us-east-1',\n  ...(process.env.STAGE === 'local' && {\n    endpoint: 'http://localhost:8000',\n    credentials: {\n      accessKeyId: 'local',\n      secretAccessKey: 'local',\n    },\n  }),\n});\n\nconst docClient = DynamoDBDocumentClient.from(dynamoClient);\n\nexport const handler = async (\n  event: APIGatewayProxyEvent\n): Promise<APIGatewayProxyResult> => {\n  try {\n    const courseId = event.pathParameters?.courseId;\n\n    if (!courseId) {\n      return {\n        statusCode: 400,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n        body: JSON.stringify({ error: 'courseId is required' }),\n      };\n    }\n\n    if (!event.body) {\n      return {\n        statusCode: 400,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n        body: JSON.stringify({ error: 'Request body is required' }),\n      };\n    }\n\n    const body = JSON.parse(event.body);\n    const { sectionId, lessonOrder } = body;\n\n    // lessonOrder should be an array like:\n    // [{ lessonId: '001-001', order: 1 }, { lessonId: '001-002', order: 2 }]\n\n    if (!sectionId || !Array.isArray(lessonOrder)) {\n      return {\n        statusCode: 400,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n        body: JSON.stringify({ \n          error: 'sectionId and lessonOrder array are required',\n          example: {\n            sectionId: '001',\n            lessonOrder: [\n              { lessonId: '001-001', order: 1 },\n              { lessonId: '001-002', order: 2 }\n            ]\n          }\n        }),\n      };\n    }\n\n    const now = new Date().toISOString();\n    const updatePromises = [];\n\n    // Update each lesson's order\n    for (const item of lessonOrder) {\n      const updatePromise = docClient.send(\n        new UpdateCommand({\n          TableName: process.env.TABLE_NAME || 'ELearningPlatform-local',\n          Key: {\n            PK: `COURSE#${courseId}`,\n            SK: `LESSON#${item.lessonId}`,\n          },\n          UpdateExpression: 'SET #order = :order, #sectionOrder = :order, #updatedAt = :now, #GSI1SK = :gsi1sk',\n          ExpressionAttributeNames: {\n            '#order': 'order',\n            '#sectionOrder': 'sectionOrder',\n            '#updatedAt': 'updatedAt',\n            '#GSI1SK': 'GSI1SK',\n          },\n          ExpressionAttributeValues: {\n            ':order': item.order,\n            ':now': now,\n            ':gsi1sk': `ORDER#${String(item.order).padStart(3, '0')}`,\n          },\n        })\n      );\n      updatePromises.push(updatePromise);\n    }\n\n    await Promise.all(updatePromises);\n\n    // Get updated lessons to return\n    const updatedLessons = await docClient.send(\n      new QueryCommand({\n        TableName: process.env.TABLE_NAME || 'ELearningPlatform-local',\n        IndexName: 'GSI1',\n        KeyConditionExpression: 'GSI1PK = :sectionKey',\n        ExpressionAttributeValues: {\n          ':sectionKey': `COURSE#${courseId}#SECTION#${sectionId}`,\n        },\n      })\n    );\n\n    return {\n      statusCode: 200,\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n      },\n      body: JSON.stringify({\n        message: 'Lessons reordered successfully',\n        lessons: updatedLessons.Items?.sort((a, b) => a.order - b.order) || [],\n      }),\n    };\n  } catch (error) {\n    console.error('Error:', error);\n    return {\n      statusCode: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n      body: JSON.stringify({\n        error: 'Internal server error',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      }),\n    };\n  }\n};"],
  "mappings": "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",
  "names": []
}
