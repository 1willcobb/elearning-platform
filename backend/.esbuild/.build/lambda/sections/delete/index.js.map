{
  "version": 3,
  "sources": ["../../../../../lambda/sections/delete/index.ts"],
  "sourcesContent": ["import { APIGatewayProxyEvent, APIGatewayProxyResult } from 'aws-lambda';\nimport { DynamoDBClient } from '@aws-sdk/client-dynamodb';\nimport { DynamoDBDocumentClient, DeleteCommand, GetCommand, QueryCommand, UpdateCommand, BatchWriteCommand } from '@aws-sdk/lib-dynamodb';\n\nconst dynamoClient = new DynamoDBClient({\n  region: process.env.AWS_REGION || 'us-east-1',\n  ...(process.env.STAGE === 'local' && {\n    endpoint: 'http://localhost:8000',\n    credentials: { accessKeyId: 'local', secretAccessKey: 'local' },\n  }),\n});\n\nconst docClient = DynamoDBDocumentClient.from(dynamoClient);\n\nexport const handler = async (event: APIGatewayProxyEvent): Promise<APIGatewayProxyResult> => {\n  try {\n    const { courseId, sectionId } = event.pathParameters || {};\n    if (!courseId || !sectionId) {\n      return {\n        statusCode: 400,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n        body: JSON.stringify({ error: 'courseId and sectionId are required' }),\n      };\n    }\n\n    const section = await docClient.send(\n      new GetCommand({\n        TableName: process.env.TABLE_NAME || 'ELearningPlatform-local',\n        Key: { PK: `COURSE#${courseId}`, SK: `SECTION#${sectionId}` },\n      })\n    );\n\n    if (!section.Item) {\n      return {\n        statusCode: 404,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n        body: JSON.stringify({ error: 'Section not found' }),\n      };\n    }\n\n    const lessons = await docClient.send(\n      new QueryCommand({\n        TableName: process.env.TABLE_NAME || 'ELearningPlatform-local',\n        IndexName: 'GSI1',\n        KeyConditionExpression: 'GSI1PK = :key',\n        ExpressionAttributeValues: { ':key': `COURSE#${courseId}#SECTION#${sectionId}` },\n      })\n    );\n\n    const items = lessons.Items || [];\n    for (let i = 0; i < items.length; i += 25) {\n      const batch = items.slice(i, i + 25);\n      await docClient.send(\n        new BatchWriteCommand({\n          RequestItems: {\n            [process.env.TABLE_NAME || 'ELearningPlatform-local']: batch.map((item) => ({\n              DeleteRequest: { Key: { PK: item.PK, SK: item.SK } },\n            })),\n          },\n        })\n      );\n    }\n\n    await docClient.send(\n      new DeleteCommand({\n        TableName: process.env.TABLE_NAME || 'ELearningPlatform-local',\n        Key: { PK: `COURSE#${courseId}`, SK: `SECTION#${sectionId}` },\n      })\n    );\n\n    await docClient.send(\n      new UpdateCommand({\n        TableName: process.env.TABLE_NAME || 'ELearningPlatform-local',\n        Key: { PK: `COURSE#${courseId}`, SK: 'METADATA' },\n        UpdateExpression: 'SET totalSections = totalSections - :dec, totalLessons = totalLessons - :lessonDec',\n        ExpressionAttributeValues: { ':dec': 1, ':lessonDec': items.length },\n      })\n    );\n\n    return {\n      statusCode: 200,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n      body: JSON.stringify({ message: 'Section and all lessons deleted successfully', deletedLessons: items.length }),\n    };\n  } catch (error) {\n    console.error('Error:', error);\n    return {\n      statusCode: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n      body: JSON.stringify({ error: 'Internal server error', message: error instanceof Error ? error.message : 'Unknown error' }),\n    };\n  }\n};\n"],
  "mappings": "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",
  "names": []
}
