{
  "version": 3,
  "sources": ["../../../../../lambda/sections/create/index.ts"],
  "sourcesContent": ["import { APIGatewayProxyEvent, APIGatewayProxyResult } from 'aws-lambda';\nimport { DynamoDBClient } from '@aws-sdk/client-dynamodb';\nimport { DynamoDBDocumentClient, PutCommand, GetCommand, QueryCommand, UpdateCommand } from '@aws-sdk/lib-dynamodb';\n\nconst dynamoClient = new DynamoDBClient({\n  region: process.env.AWS_REGION || 'us-east-1',\n  ...(process.env.STAGE === 'local' && {\n    endpoint: 'http://localhost:8000',\n    credentials: { accessKeyId: 'local', secretAccessKey: 'local' },\n  }),\n});\n\nconst docClient = DynamoDBDocumentClient.from(dynamoClient);\n\nexport const handler = async (event: APIGatewayProxyEvent): Promise<APIGatewayProxyResult> => {\n  try {\n    const courseId = event.pathParameters?.courseId;\n    if (!courseId) {\n      return {\n        statusCode: 400,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n        body: JSON.stringify({ error: 'courseId is required' }),\n      };\n    }\n\n    if (!event.body) {\n      return {\n        statusCode: 400,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n        body: JSON.stringify({ error: 'Request body is required' }),\n      };\n    }\n\n    const course = await docClient.send(\n      new GetCommand({\n        TableName: process.env.TABLE_NAME || 'ELearningPlatform-local',\n        Key: { PK: `COURSE#${courseId}`, SK: 'METADATA' },\n      })\n    );\n\n    if (!course.Item) {\n      return {\n        statusCode: 404,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n        body: JSON.stringify({ error: 'Course not found' }),\n      };\n    }\n\n    const body = JSON.parse(event.body);\n    const now = new Date().toISOString();\n\n    const existingSections = await docClient.send(\n      new QueryCommand({\n        TableName: process.env.TABLE_NAME || 'ELearningPlatform-local',\n        KeyConditionExpression: 'PK = :pk AND begins_with(SK, :sk)',\n        ExpressionAttributeValues: {\n          ':pk': `COURSE#${courseId}`,\n          ':sk': 'SECTION#',\n        },\n      })\n    );\n\n    const sectionCount = existingSections.Items?.length || 0;\n    const order = body.order || (sectionCount + 1);\n    const sectionId = String(order).padStart(3, '0');\n\n    const sectionData = {\n      PK: `COURSE#${courseId}`,\n      SK: `SECTION#${sectionId}`,\n      EntityType: 'CourseSection',\n      sectionId,\n      courseId,\n      title: body.title,\n      description: body.description || '',\n      order,\n      duration: 0,\n      lessonCount: 0,\n      isPublished: body.isPublished || false,\n      isFree: body.isFree || false,\n      createdAt: now,\n      updatedAt: now,\n      GSI1PK: `COURSE#${courseId}#SECTIONS`,\n      GSI1SK: `ORDER#${sectionId}`,\n    };\n\n    await docClient.send(\n      new PutCommand({\n        TableName: process.env.TABLE_NAME || 'ELearningPlatform-local',\n        Item: sectionData,\n      })\n    );\n\n    await docClient.send(\n      new UpdateCommand({\n        TableName: process.env.TABLE_NAME || 'ELearningPlatform-local',\n        Key: { PK: `COURSE#${courseId}`, SK: 'METADATA' },\n        UpdateExpression: 'SET totalSections = totalSections + :inc, updatedAt = :now',\n        ExpressionAttributeValues: { ':inc': 1, ':now': now },\n      })\n    );\n\n    return {\n      statusCode: 201,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n      body: JSON.stringify({ message: 'Section created successfully', section: sectionData }),\n    };\n  } catch (error) {\n    console.error('Error:', error);\n    return {\n      statusCode: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n      body: JSON.stringify({ error: 'Internal server error', message: error instanceof Error ? error.message : 'Unknown error' }),\n    };\n  }\n};\n"],
  "mappings": "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",
  "names": []
}
