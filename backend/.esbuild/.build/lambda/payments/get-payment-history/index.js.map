{
  "version": 3,
  "sources": ["../../../../../lambda/payments/get-payment-history/index.ts"],
  "sourcesContent": ["import { APIGatewayProxyEvent, APIGatewayProxyResult } from 'aws-lambda';\nimport { DynamoDBClient } from '@aws-sdk/client-dynamodb';\nimport { DynamoDBDocumentClient, QueryCommand } from '@aws-sdk/lib-dynamodb';\n\nconst dynamoClient = new DynamoDBClient({\n  region: process.env.AWS_REGION || 'us-east-1',\n  ...(process.env.STAGE === 'local' && {\n    endpoint: 'http://localhost:8000',\n    credentials: { accessKeyId: 'local', secretAccessKey: 'local' },\n  }),\n});\n\nconst docClient = DynamoDBDocumentClient.from(dynamoClient);\n\nexport const handler = async (\n  event: APIGatewayProxyEvent\n): Promise<APIGatewayProxyResult> => {\n  try {\n    const userId = event.pathParameters?.userId || 'user123'; // TODO: Get from JWT\n    const { limit = '20' } = event.queryStringParameters || {};\n\n    const result = await docClient.send(\n      new QueryCommand({\n        TableName: process.env.TABLE_NAME || 'ELearningPlatform-local',\n        IndexName: 'GSI1',\n        KeyConditionExpression: 'GSI1PK = :key',\n        ExpressionAttributeValues: {\n          ':key': `USER#${userId}#PAYMENTS`,\n        },\n        Limit: parseInt(limit),\n        ScanIndexForward: false, // Most recent first\n      })\n    );\n\n    return {\n      statusCode: 200,\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n      },\n      body: JSON.stringify({\n        payments: result.Items || [],\n        total: result.Items?.length || 0,\n      }),\n    };\n  } catch (error) {\n    console.error('Error:', error);\n    return {\n      statusCode: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' },\n      body: JSON.stringify({\n        error: 'Internal server error',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      }),\n    };\n  }\n};"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,6BAA+B;AAC/B,0BAAqD;AAErD,IAAM,eAAe,IAAI,sCAAe;AAAA,EACtC,QAAQ,QAAQ,IAAI,cAAc;AAAA,EAClC,GAAI,QAAQ,IAAI,UAAU,WAAW;AAAA,IACnC,UAAU;AAAA,IACV,aAAa,EAAE,aAAa,SAAS,iBAAiB,QAAQ;AAAA,EAChE;AACF,CAAC;AAED,IAAM,YAAY,2CAAuB,KAAK,YAAY;AAEnD,IAAM,UAAU,OACrB,UACmC;AACnC,MAAI;AACF,UAAM,SAAS,MAAM,gBAAgB,UAAU;AAC/C,UAAM,EAAE,QAAQ,KAAK,IAAI,MAAM,yBAAyB,CAAC;AAEzD,UAAM,SAAS,MAAM,UAAU;AAAA,MAC7B,IAAI,iCAAa;AAAA,QACf,WAAW,QAAQ,IAAI,cAAc;AAAA,QACrC,WAAW;AAAA,QACX,wBAAwB;AAAA,QACxB,2BAA2B;AAAA,UACzB,QAAQ,QAAQ,MAAM;AAAA,QACxB;AAAA,QACA,OAAO,SAAS,KAAK;AAAA,QACrB,kBAAkB;AAAA;AAAA,MACpB,CAAC;AAAA,IACH;AAEA,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,+BAA+B;AAAA,MACjC;AAAA,MACA,MAAM,KAAK,UAAU;AAAA,QACnB,UAAU,OAAO,SAAS,CAAC;AAAA,QAC3B,OAAO,OAAO,OAAO,UAAU;AAAA,MACjC,CAAC;AAAA,IACH;AAAA,EACF,SAAS,OAAO;AACd,YAAQ,MAAM,UAAU,KAAK;AAC7B,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS,EAAE,gBAAgB,oBAAoB,+BAA+B,IAAI;AAAA,MAClF,MAAM,KAAK,UAAU;AAAA,QACnB,OAAO;AAAA,QACP,SAAS,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MACpD,CAAC;AAAA,IACH;AAAA,EACF;AACF;",
  "names": []
}
